<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guide | Lumen Laravel MongoDB</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/llm.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/llm.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/assets/img/logo.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="This is a documentation of the laravel lumen mongodb. using some of the best practices, contributers are highly accepted to make this docs more readable and useful for laravel devs who uses mongodb.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/img/logo.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.00b3f121.css" as="style"><link rel="preload" href="/assets/js/app.1e70265b.js" as="script"><link rel="preload" href="/assets/js/2.7d16e0a0.js" as="script"><link rel="preload" href="/assets/js/9.822b995c.js" as="script"><link rel="preload" href="/assets/js/5.4d3df407.js" as="script"><link rel="prefetch" href="/assets/js/10.9422f283.js"><link rel="prefetch" href="/assets/js/11.d27c366d.js"><link rel="prefetch" href="/assets/js/3.f0c43581.js"><link rel="prefetch" href="/assets/js/4.18e6b38d.js"><link rel="prefetch" href="/assets/js/6.0991aa63.js"><link rel="prefetch" href="/assets/js/7.c7162488.js"><link rel="prefetch" href="/assets/js/8.a79b4c78.js">
    <link rel="stylesheet" href="/assets/css/0.styles.00b3f121.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Lumen Laravel MongoDB</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Version</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Version</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/3xx/" class="nav-link router-link-active">
  3.x.x
</a></li><li class="dropdown-item"><!----> <a href="/2xx/" class="nav-link">
  2.x.x
</a></li></ul></div></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M7.5 1.5v-1m0 13.99v-.998m6-5.997h1m-13 0h-1m2-4.996l-1-1m12 0l-1 1m-10 9.993l-1 1m12 0l-1-1m-2-4.997a2.999 2.999 0 01-3 2.998 2.999 2.999 0 113-2.998z" stroke="currentColor" stroke-linecap="square"></path></svg></span></a></div> <a href="https://github.com/BroJenuel-Youtube/laravel-mongodb" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Version</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Version</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/3xx/" class="nav-link router-link-active">
  3.x.x
</a></li><li class="dropdown-item"><!----> <a href="/2xx/" class="nav-link">
  2.x.x
</a></li></ul></div></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M7.5 1.5v-1m0 13.99v-.998m6-5.997h1m-13 0h-1m2-4.996l-1-1m12 0l-1 1m-10 9.993l-1 1m12 0l-1-1m-2-4.997a2.999 2.999 0 01-3 2.998 2.999 2.999 0 113-2.998z" stroke="currentColor" stroke-linecap="square"></path></svg></span></a></div> <a href="https://github.com/BroJenuel-Youtube/laravel-mongodb" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/3xx/" aria-current="page" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3xx/#laravel-version-compatibility" class="sidebar-link">Laravel version Compatibility</a></li></ul></li><li><a href="/3xx/guide.html" aria-current="page" class="active sidebar-link">Guide</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3xx/guide.html#installation" class="sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3xx/guide.html#laravel" class="sidebar-link">Laravel</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#lumen" class="sidebar-link">Lumen</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#non-laravel-projects" class="sidebar-link">Non-Laravel projects</a></li></ul></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#testing" class="sidebar-link">Testing</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#database-testing" class="sidebar-link">Database Testing</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#eloquent" class="sidebar-link">Eloquent</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3xx/guide.html#extending-the-base-model" class="sidebar-link">Extending the base model</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#extending-the-authenticable-base-model" class="sidebar-link">Extending the Authenticable base model</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#soft-deletes" class="sidebar-link">Soft Deletes</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#guarding-attributes" class="sidebar-link">Guarding attributes</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#dates" class="sidebar-link">Dates</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#basic-usage" class="sidebar-link">Basic Usage</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#mongodb-specific-operators" class="sidebar-link">MongoDB-specific operators</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#mongodb-specific-geo-operations" class="sidebar-link">MongoDB-specific Geo operations</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#inserts-updates-and-deletes" class="sidebar-link">Inserts, updates and deletes</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#mongodb-specific-operations" class="sidebar-link">MongoDB specific operations</a></li></ul></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#relationships" class="sidebar-link">Relationships</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3xx/guide.html#basic-usage-2" class="sidebar-link">Basic Usage</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#belongstomany-and-pivots" class="sidebar-link">belongsToMany and pivots</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#embedsmany-relationship" class="sidebar-link">EmbedsMany Relationship</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#embedsone-relationship" class="sidebar-link">EmbedsOne Relationship</a></li></ul></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#query-builder" class="sidebar-link">Query Builder</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3xx/guide.html#basic-usage-3" class="sidebar-link">Basic Usage</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#available-operations" class="sidebar-link">Available operations</a></li></ul></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#schema" class="sidebar-link">Schema</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3xx/guide.html#basic-usage-4" class="sidebar-link">Basic Usage</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#geospatial-indexes" class="sidebar-link">Geospatial indexes</a></li></ul></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#extending" class="sidebar-link">Extending</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3xx/guide.html#cross-database-relationships" class="sidebar-link">Cross-Database Relationships</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#authentication" class="sidebar-link">Authentication</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#queues" class="sidebar-link">Queues</a></li></ul></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#upgrading" class="sidebar-link">Upgrading</a></li><li class="sidebar-sub-header"><a href="/3xx/guide.html#security-contact-information" class="sidebar-link">Security contact information</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-succinct-content content__default"><h2 id="installation"><a href="#installation" class="header-anchor">#</a> Installation</h2> <p>Install the package via Composer:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">composer</span> require jenssegers/mongodb
</code></pre></div><h3 id="laravel"><a href="#laravel" class="header-anchor">#</a> Laravel</h3> <p>In case your Laravel version does NOT autoload the packages, add the service provider to <code>config/app.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name class-name-fully-qualified static-context">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>MongodbServiceProvider</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="lumen"><a href="#lumen" class="header-anchor">#</a> Lumen</h3> <p>For usage with <a href="http://lumen.laravel.com" target="_blank" rel="noopener noreferrer">Lumen<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, add the service provider in <code>bootstrap/app.php</code>. In this file, you will also need to enable Eloquent. You must however ensure that your call to <code>$app-&gt;withEloquent();</code> is <strong>below</strong> where you have registered the <code>MongodbServiceProvider</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>MongodbServiceProvider</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token function">withEloquent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The service provider will register a MongoDB database extension with the original database manager. There is no need to register additional facades or objects.</p> <p>When using MongoDB connections, Laravel will automatically provide you with the corresponding MongoDB objects.</p> <h3 id="non-laravel-projects"><a href="#non-laravel-projects" class="header-anchor">#</a> Non-Laravel projects</h3> <p>For usage outside Laravel, check out the <a href="https://github.com/illuminate/database/blob/master/README.md" target="_blank" rel="noopener noreferrer">Capsule manager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and add:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$capsule</span><span class="token operator">-&gt;</span><span class="token function">getDatabaseManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mongodb'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Connection</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="testing"><a href="#testing" class="header-anchor">#</a> Testing</h2> <p>To run the test for this package, run:</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose up
</code></pre></div><h2 id="database-testing"><a href="#database-testing" class="header-anchor">#</a> Database Testing</h2> <p>To reset the database after each test, add:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>DatabaseMigrations</span><span class="token punctuation">;</span>
</code></pre></div><p>Also inside each test classes, add:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">DatabaseMigrations</span><span class="token punctuation">;</span>
</code></pre></div><p>Keep in mind that these traits are not yet supported:</p> <ul><li><code>use Database Transactions;</code></li> <li><code>use RefreshDatabase;</code></li></ul> <h2 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h2> <p>You can use MongoDB either as the main database, either as a side database. To do so, add a new <code>mongodb</code> connection to <code>config/database.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string single-quoted-string">'mongodb'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'driver'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'mongodb'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'DB_HOST'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'DB_PORT'</span><span class="token punctuation">,</span> <span class="token number">27017</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'database'</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'DB_DATABASE'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'homestead'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'username'</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'DB_USERNAME'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'homestead'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'password'</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'DB_PASSWORD'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'secret'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'options'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token comment">// here you can pass more settings to the Mongo Driver Manager</span>
        <span class="token comment">// see https://www.php.net/manual/en/mongodb-driver-manager.construct.php under &quot;Uri Options&quot; for a list of complete parameters that you can use</span>

        <span class="token string single-quoted-string">'database'</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'DB_AUTHENTICATION_DATABASE'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// required with Mongo 3+</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>For multiple servers or replica set configurations, set the host to an array and specify each server host:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string single-quoted-string">'mongodb'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'driver'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'mongodb'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'server1'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'server2'</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
    <span class="token string single-quoted-string">'options'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'replicaSet'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'rs0'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>If you wish to use a connection string instead of full key-value params, you can set it so. Check the documentation on MongoDB's URI format: https://docs.mongodb.com/manual/reference/connection-string/</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string single-quoted-string">'mongodb'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'driver'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'mongodb'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'dsn'</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'DB_DSN'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'database'</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'DB_DATABASE'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'homestead'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="eloquent"><a href="#eloquent" class="header-anchor">#</a> Eloquent</h2> <h3 id="extending-the-base-model"><a href="#extending-the-base-model" class="header-anchor">#</a> Extending the base model</h3> <p>This package includes a MongoDB enabled Eloquent class that you can use to define models for corresponding collections.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Just like a normal model, the MongoDB model class will know which collection to use based on the model name. For <code>Book</code>, the collection <code>books</code> will be used.</p> <p>To change the collection, pass the <code>$collection</code> property:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_books_collection'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>NOTE:</strong> MongoDB documents are automatically stored with a unique ID that is stored in the <code>_id</code> property. If you wish to use your own ID, substitute the <code>$primaryKey</code> property and set it to your own primary key attribute name.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$primaryKey</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'id'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Mongo will also create _id, but the 'id' property will be used for primary key actions like find().</span>
<span class="token class-name static-context">Book</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'The Fault in Our Stars'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Likewise, you may define a <code>connection</code> property to override the name of the database connection that should be used when utilizing the model.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'mongodb'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="extending-the-authenticable-base-model"><a href="#extending-the-authenticable-base-model" class="header-anchor">#</a> Extending the Authenticable base model</h3> <p>This package includes a MongoDB Authenticatable Eloquent class <code>Jenssegers\Mongodb\Auth\User</code> that you can use to replace the default Authenticatable class <code>Illuminate\Foundation\Auth\User</code> for your <code>User</code> model.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> Authenticatable<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="soft-deletes"><a href="#soft-deletes" class="header-anchor">#</a> Soft Deletes</h3> <p>When soft deleting a model, it is not actually removed from your database. Instead, a deleted_at timestamp is set on the record.</p> <p>To enable soft deletes for a model, apply the <code>Jenssegers\Mongodb\Eloquent\SoftDeletes</code> Trait to the model:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>SoftDeletes</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">SoftDeletes</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token variable">$dates</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'deleted_at'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For more information check <a href="http://laravel.com/docs/eloquent#soft-deleting" target="_blank" rel="noopener noreferrer">Laravel Docs about Soft Deleting<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="guarding-attributes"><a href="#guarding-attributes" class="header-anchor">#</a> Guarding attributes</h3> <p>When choosing between guarding attributes or marking some as fillable, Taylor Otwell prefers the fillable route.
This is in light of <a href="https://blog.laravel.com/security-release-laravel-61835-7240" target="_blank" rel="noopener noreferrer">recent security issues described here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Keep in mind guarding still works, but you may experience unexpected behavior.</p> <h3 id="dates"><a href="#dates" class="header-anchor">#</a> Dates</h3> <p>Eloquent allows you to work with Carbon or DateTime objects instead of MongoDate objects. Internally, these dates will be converted to MongoDate objects when saved to the database.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$dates</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'birthday'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This allows you to execute queries like this:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span>
    <span class="token string single-quoted-string">'birthday'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'-18 years'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="basic-usage"><a href="#basic-usage" class="header-anchor">#</a> Basic Usage</h3> <p><strong>Retrieving all models</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Retrieving a record by primary key</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'517c43667db388101e00000f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Where</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span>
    <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'author.name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>OR Statements</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span>
    <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'votes'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'is_approved'</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>AND statements</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span>
    <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'!='</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>whereIn</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When using <code>whereNotIn</code> objects will be returned if the field is non-existent. Combine with <code>whereNotNull('age')</code> to leave out those documents.</p> <p><strong>whereBetween</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">whereBetween</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'votes'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>whereNull</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">whereNull</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>whereDate</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">whereDate</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'birthday'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'2021-5-12'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The usage is the same as <code>whereMonth</code> / <code>whereDay</code> / <code>whereYear</code> / <code>whereTime</code></p> <p><strong>Advanced wheres</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span>
    <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$query</span>
                <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'votes'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
                <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;&gt;'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>orderBy</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'desc'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Offset &amp; Limit (skip &amp; take)</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span>
    <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>groupBy</strong></p> <p>Selected columns that are not grouped will be aggregated with the <code>$last</code> function.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span>
    <span class="token class-name static-context">Users</span><span class="token operator">::</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Distinct</strong></p> <p>Distinct requires a field for which to return the distinct values.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Equivalent to:</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Distinct can be combined with <strong>where</strong>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span>
    <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'active'</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Like</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$spamComments</span> <span class="token operator">=</span> <span class="token class-name static-context">Comment</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'body'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'like'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'%spam%'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Aggregation</strong></p> <p><strong>Aggregations are only available for MongoDB versions greater than 2.2.x</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$total</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$price</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$price</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$price</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$total</span> <span class="token operator">=</span> <span class="token class-name static-context">Product</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Aggregations can be combined with <strong>where</strong>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$sold</span> <span class="token operator">=</span> <span class="token class-name static-context">Orders</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sold'</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Aggregations can be also used on sub-documents:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$total</span> <span class="token operator">=</span> <span class="token class-name static-context">Order</span><span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'suborder.price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>NOTE</strong>: This aggregation only works with single sub-documents (like <code>EmbedsOne</code>) not subdocument arrays (like <code>EmbedsMany</code>).</p> <p><strong>Incrementing/Decrementing the value of a column</strong></p> <p>Perform increments or decrements (default 1) on specified attributes:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cat</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Kitty'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Car</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Toyota'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'weight'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The number of updated objects is returned:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$count</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You may also specify additional columns to update:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cat</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'group'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Kitty Club'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Car</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'weight'</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'weight'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'latest_change'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'carbon fiber'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mongodb-specific-operators"><a href="#mongodb-specific-operators" class="header-anchor">#</a> MongoDB-specific operators</h3> <p><strong>Exists</strong></p> <p>Matches documents that have the specified field.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'exists'</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>All</strong></p> <p>Matches arrays that contain all elements specified in the query.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'roles'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'all'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'moderator'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'author'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Size</strong></p> <p>Selects documents if the array field is a specified size.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Post</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tags'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'size'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Regex</strong></p> <p>Selects documents where values match a specified regular expression.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">MongoDB<span class="token punctuation">\</span>BSON<span class="token punctuation">\</span>Regex</span><span class="token punctuation">;</span>

<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'regex'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Regex</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.*doe'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>NOTE:</strong> you can also use the Laravel regexp operations. These are a bit more flexible and will automatically convert your regular expression string to a <code>MongoDB\BSON\Regex</code> object.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'regexp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/.*doe/i'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The inverse of regexp:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'not regexp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/.*doe/i'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Type</strong></p> <p>Selects documents if a field is of the specified type. For more information check: http://docs.mongodb.org/manual/reference/operator/query/type/#op._S_type</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'type'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Mod</strong></p> <p>Performs a modulo operation on the value of a field and selects documents with a specified result.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mod'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mongodb-specific-geo-operations"><a href="#mongodb-specific-geo-operations" class="header-anchor">#</a> MongoDB-specific Geo operations</h3> <p><strong>Near</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$bars</span> <span class="token operator">=</span> <span class="token class-name static-context">Bar</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'near'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'$geometry'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Point'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'coordinates'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token operator">-</span><span class="token number">0.1367563</span><span class="token punctuation">,</span> <span class="token comment">// longitude</span>
            <span class="token number">51.5100913</span><span class="token punctuation">,</span> <span class="token comment">// latitude</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'$maxDistance'</span> <span class="token operator">=&gt;</span> <span class="token number">50</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>GeoWithin</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$bars</span> <span class="token operator">=</span> <span class="token class-name static-context">Bar</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'geoWithin'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'$geometry'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Polygon'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'coordinates'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1450383</span><span class="token punctuation">,</span> <span class="token number">51.5069158</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1367563</span><span class="token punctuation">,</span> <span class="token number">51.5100913</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1270247</span><span class="token punctuation">,</span> <span class="token number">51.5013233</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1450383</span><span class="token punctuation">,</span> <span class="token number">51.5069158</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>GeoIntersects</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$bars</span> <span class="token operator">=</span> <span class="token class-name static-context">Bar</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'geoIntersects'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'$geometry'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'LineString'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'coordinates'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.144044</span><span class="token punctuation">,</span> <span class="token number">51.515215</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.129545</span><span class="token punctuation">,</span> <span class="token number">51.507864</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="inserts-updates-and-deletes"><a href="#inserts-updates-and-deletes" class="header-anchor">#</a> Inserts, updates and deletes</h3> <p>Inserting, updating and deleting records works just like the original Eloquent. Please check <a href="https://laravel.com/docs/6.x/eloquent" target="_blank" rel="noopener noreferrer">Laravel Docs' Eloquent section<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Here, only the MongoDB-specific operations are specified.</p> <h3 id="mongodb-specific-operations"><a href="#mongodb-specific-operations" class="header-anchor">#</a> MongoDB specific operations</h3> <p><strong>Raw Expressions</strong></p> <p>These expressions will be injected directly into the query.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">whereRaw</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'age'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'$gt'</span> <span class="token operator">=&gt;</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'$lt'</span> <span class="token operator">=&gt;</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">whereRaw</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'$where'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'/.*123.*/.test(this.field)'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">whereRaw</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'$where'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'/.*123.*/.test(this[&quot;hyphenated-field&quot;])'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also perform raw expressions on the internal MongoCollection object. If this is executed on the model class, it will return a collection of models.</p> <p>If this is executed on the query builder, it will return the original response.</p> <p><strong>Cursor timeout</strong></p> <p>To prevent <code>MongoCursorTimeout</code> exceptions, you can manually set a timeout value that will be applied to the cursor:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Upsert</strong></p> <p>Update or insert a document. Additional options for the update method are passed directly to the native update method.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Query Builder</span>
<span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'upsert'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Eloquent</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'upsert'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Projections</strong></p> <p>You can apply projections to your queries using the <code>project</code> method.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'items'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tags'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'$slice'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'items'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tags'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'$slice'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Projections with Pagination</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token variable">$projections</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'items'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">,</span> <span class="token variable">$projections</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Push</strong></p> <p>Add items to an array.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'items'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'boots'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'items'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'boots'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'messages'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'from'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Jane Doe'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Hi John'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'messages'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'from'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Jane Doe'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Hi John'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you <strong>DON'T</strong> want duplicate items, set the third parameter to <code>true</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'items'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'boots'</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'items'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'boots'</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Pull</strong></p> <p>Remove an item from an array.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'items'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'boots'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'items'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'boots'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'messages'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'from'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Jane Doe'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Hi John'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'messages'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'from'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Jane Doe'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'message'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Hi John'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Unset</strong></p> <p>Remove one or more fields from a document.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'note'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'note'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="relationships"><a href="#relationships" class="header-anchor">#</a> Relationships</h2> <h3 id="basic-usage-2"><a href="#basic-usage-2" class="header-anchor">#</a> Basic Usage</h3> <p>The only available relationships are:</p> <ul><li>hasOne</li> <li>hasMany</li> <li>belongsTo</li> <li>belongsToMany</li></ul> <p>The MongoDB-specific relationships are:</p> <ul><li>embedsOne</li> <li>embedsMany</li></ul> <p>Here is a small example:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token class-name static-context">Item</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The inverse relation of <code>hasMany</code> is <code>belongsTo</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="belongstomany-and-pivots"><a href="#belongstomany-and-pivots" class="header-anchor">#</a> belongsToMany and pivots</h3> <p>The belongsToMany relation will not use a pivot &quot;table&quot; but will push id's to a <strong>related_ids</strong> attribute instead. This makes the second parameter for the belongsToMany method useless.</p> <p>If you want to define custom keys for your relation, set it to <code>null</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>
            <span class="token class-name static-context">Group</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'user_ids'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'group_ids'</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="embedsmany-relationship"><a href="#embedsmany-relationship" class="header-anchor">#</a> EmbedsMany Relationship</h3> <p>If you want to embed models, rather than referencing them, you can use the <code>embedsMany</code> relation. This relation is similar to the <code>hasMany</code> relation but embeds the models inside the parent object.</p> <p><strong>REMEMBER</strong>: These relations return Eloquent collections, they don't return query builder objects!</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">embedsMany</span><span class="token punctuation">(</span><span class="token class-name static-context">Book</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can access the embedded models through the dynamic property:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">books</span> <span class="token keyword">as</span> <span class="token variable">$book</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The inverse relation is auto<em>magically</em> available. You don't need to define this reverse relation.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$book</span> <span class="token operator">=</span> <span class="token class-name static-context">Book</span><span class="token operator">::</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$book</span><span class="token operator">-&gt;</span><span class="token property">user</span><span class="token punctuation">;</span>
</code></pre></div><p>Inserting and updating embedded models works similar to the <code>hasMany</code> relation:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$book</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'A Game of Thrones'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or</span>
<span class="token variable">$book</span> <span class="token operator">=</span>
    <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'A Game of Thrones'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can update embedded models using their <code>save</code> method (available since release 2.0.0):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$book</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$book</span><span class="token operator">-&gt;</span><span class="token property">title</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'A Game of Thrones'</span><span class="token punctuation">;</span>
<span class="token variable">$book</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can remove an embedded model by using the <code>destroy</code> method on the relation, or the <code>delete</code> method on the model (available since release 2.0.0):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$book</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Similar operation</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token variable">$book</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you want to add or remove an embedded model, without touching the database, you can use the <code>associate</code> and <code>dissociate</code> methods.</p> <p>To eventually write the changes to the database, save the parent object:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">associate</span><span class="token punctuation">(</span><span class="token variable">$book</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Like other relations, embedsMany assumes the local key of the relationship based on the model name. You can override the default local key by passing a second argument to the embedsMany method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">embedsMany</span><span class="token punctuation">(</span><span class="token class-name static-context">Book</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'local_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Embedded relations will return a Collection of embedded items instead of a query builder. Check out the available operations here: https://laravel.com/docs/master/collections</p> <h3 id="embedsone-relationship"><a href="#embedsone-relationship" class="header-anchor">#</a> EmbedsOne Relationship</h3> <p>The embedsOne relation is similar to the embedsMany relation, but only embeds a single model.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">embedsOne</span><span class="token punctuation">(</span><span class="token class-name static-context">Author</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can access the embedded models through the dynamic property:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$book</span> <span class="token operator">=</span> <span class="token class-name static-context">Book</span><span class="token operator">::</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$author</span> <span class="token operator">=</span> <span class="token variable">$book</span><span class="token operator">-&gt;</span><span class="token property">author</span><span class="token punctuation">;</span>
</code></pre></div><p>Inserting and updating embedded models works similar to the <code>hasOne</code> relation:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$author</span> <span class="token operator">=</span> <span class="token variable">$book</span><span class="token operator">-&gt;</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Author</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'John Doe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Similar</span>
<span class="token variable">$author</span> <span class="token operator">=</span>
    <span class="token variable">$book</span><span class="token operator">-&gt;</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'John Doe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can update the embedded model using the <code>save</code> method (available since release 2.0.0):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$author</span> <span class="token operator">=</span> <span class="token variable">$book</span><span class="token operator">-&gt;</span><span class="token property">author</span><span class="token punctuation">;</span>

<span class="token variable">$author</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Jane Doe'</span><span class="token punctuation">;</span>
<span class="token variable">$author</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can replace the embedded model with a new model like this:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$newAuthor</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Author</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Jane Doe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$book</span><span class="token operator">-&gt;</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$newAuthor</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="query-builder"><a href="#query-builder" class="header-anchor">#</a> Query Builder</h2> <h3 id="basic-usage-3"><a href="#basic-usage-3" class="header-anchor">#</a> Basic Usage</h3> <p>The database driver plugs right into the original query builder.</p> <p>When using MongoDB connections, you will be able to build fluent queries to perform database operations.</p> <p>For your convenience, there is a <code>collection</code> alias for <code>table</code> as well as some additional MongoDB specific operators/operations.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'books'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$hungerGames</span> <span class="token operator">=</span>
    <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'books'</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Hunger Games'</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you are familiar with <a href="http://laravel.com/docs/queries" target="_blank" rel="noopener noreferrer">Eloquent Queries<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, there is the same functionality.</p> <h3 id="available-operations"><a href="#available-operations" class="header-anchor">#</a> Available operations</h3> <p>To see the available operations, check the <a href="#eloquent">Eloquent</a> section.</p> <h2 id="schema"><a href="#schema" class="header-anchor">#</a> Schema</h2> <p>The database driver also has (limited) schema builder support. You can easily manipulate collections and set indexes.</p> <h3 id="basic-usage-4"><a href="#basic-usage-4" class="header-anchor">#</a> Basic Usage</h3> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$collection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also pass all the parameters specified <a href="https://docs.mongodb.com/manual/reference/method/db.collection.createIndex/#options-for-all-index-types" target="_blank" rel="noopener noreferrer">in the MongoDB docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to the <code>$options</code> parameter:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$collection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span>
        <span class="token string single-quoted-string">'username'</span><span class="token punctuation">,</span>
        <span class="token constant">null</span><span class="token punctuation">,</span>
        <span class="token constant">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'sparse'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'unique'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'background'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Inherited operations:</p> <ul><li>create and drop</li> <li>collection</li> <li>hasCollection</li> <li>index and dropIndex (compound indexes supported as well)</li> <li>unique</li></ul> <p>MongoDB specific operations:</p> <ul><li>background</li> <li>sparse</li> <li>expire</li> <li>geospatial</li></ul> <p>All other (unsupported) operations are implemented as dummy pass-through methods because MongoDB does not use a predefined schema.</p> <p>Read more about the schema builder on <a href="https://laravel.com/docs/6.0/migrations#tables" target="_blank" rel="noopener noreferrer">Laravel Docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="geospatial-indexes"><a href="#geospatial-indexes" class="header-anchor">#</a> Geospatial indexes</h3> <p>Geospatial indexes are handy for querying location-based documents.</p> <p>They come in two forms: <code>2d</code> and <code>2dsphere</code>. Use the schema builder to add these to a collection.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bars'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$collection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">geospatial</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To add a <code>2dsphere</code> index:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bars'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$collection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">geospatial</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'2dsphere'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="extending"><a href="#extending" class="header-anchor">#</a> Extending</h2> <h3 id="cross-database-relationships"><a href="#cross-database-relationships" class="header-anchor">#</a> Cross-Database Relationships</h3> <p>If you're using a hybrid MongoDB and SQL setup, you can define relationships across them.</p> <p>The model will automatically return a MongoDB-related or SQL-related relation based on the type of the related model.</p> <p>If you want this functionality to work both ways, your SQL-models will need to use the <code>Jenssegers\Mongodb\Eloquent\HybridRelations</code> trait.</p> <p><strong>This functionality only works for <code>hasOne</code>, <code>hasMany</code> and <code>belongsTo</code>.</strong></p> <p>The MySQL model should use the <code>HybridRelations</code> trait:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>HybridRelations</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HybridRelations</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'mysql'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">messages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token class-name static-context">Message</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Within your MongoDB model, you should define the relationship:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Message</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'mongodb'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h3> <p>If you want to use Laravel's native Auth functionality, register this included service provider:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name class-name-fully-qualified static-context">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>PasswordResetServiceProvider</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><p>This service provider will slightly modify the internal DatabaseReminderRepository to add support for MongoDB based password reminders.</p> <p>If you don't use password reminders, you don't have to register this service provider and everything else should work just fine.</p> <h3 id="queues"><a href="#queues" class="header-anchor">#</a> Queues</h3> <p>If you want to use MongoDB as your database backend, change the driver in <code>config/queue.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string single-quoted-string">'connections'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'database'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'driver'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'mongodb'</span><span class="token punctuation">,</span>
        <span class="token comment">// You can also specify your jobs specific database created on config/database.php</span>
        <span class="token string single-quoted-string">'connection'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'mongodb-job'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'table'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'jobs'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'queue'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'default'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'expire'</span> <span class="token operator">=&gt;</span> <span class="token number">60</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>If you want to use MongoDB to handle failed jobs, change the database in <code>config/queue.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string single-quoted-string">'failed'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'driver'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'mongodb'</span><span class="token punctuation">,</span>
    <span class="token comment">// You can also specify your jobs specific database created on config/database.php</span>
    <span class="token string single-quoted-string">'database'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'mongodb-job'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'table'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'failed_jobs'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="laravel-specific"><a href="#laravel-specific" class="header-anchor">#</a> Laravel specific</h4> <p>Add the service provider in <code>config/app.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name class-name-fully-qualified static-context">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>MongodbQueueServiceProvider</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="lumen-specific"><a href="#lumen-specific" class="header-anchor">#</a> Lumen specific</h4> <p>With <a href="http://lumen.laravel.com" target="_blank" rel="noopener noreferrer">Lumen<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, add the service provider in <code>bootstrap/app.php</code>. You must however ensure that you add the following <strong>after</strong> the <code>MongodbServiceProvider</code> registration.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'queue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$app</span><span class="token operator">-&gt;</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>MongodbQueueServiceProvider</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="upgrading"><a href="#upgrading" class="header-anchor">#</a> Upgrading</h2> <h4 id="upgrading-from-version-2-to-3"><a href="#upgrading-from-version-2-to-3" class="header-anchor">#</a> Upgrading from version 2 to 3</h4> <p>In this new major release which supports the new MongoDB PHP extension, we also moved the location of the Model class and replaced the MySQL model class with a trait.</p> <p>Please change all <code>Jenssegers\Mongodb\Model</code> references to <code>Jenssegers\Mongodb\Eloquent\Model</code> either at the top of your model files or your registered alias.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you are using hybrid relations, your MySQL classes should now extend the original Eloquent model class <code>Illuminate\Database\Eloquent\Model</code> instead of the removed <code>Jenssegers\Eloquent\Model</code>.</p> <p>Instead use the new <code>Jenssegers\Mongodb\Eloquent\HybridRelations</code> trait. This should make things more clear as there is only one single model class in this package.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>HybridRelations</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>

    <span class="token keyword">use</span> <span class="token package">HybridRelations</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'mysql'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Embedded relations now return an <code>Illuminate\Database\Eloquent\Collection</code> rather than a custom Collection class. If you were using one of the special methods that were available, convert them to Collection operations.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="security-contact-information"><a href="#security-contact-information" class="header-anchor">#</a> Security contact information</h2> <p>To report a security vulnerability, follow <a href="https://tidelift.com/security" target="_blank" rel="noopener noreferrer">these steps<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/BroJenuel-Youtube/laravel-mongodb/edit/master/docs/src/3xx/guide.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/21/2021, 7:09:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/3xx/" class="prev router-link-active">
        Introduction
      </a></span> <!----></p></div> </main></div><div class="global-ui"><div style="visibility:hidden;display:none;"></div><!----></div></div>
    <script src="/assets/js/app.1e70265b.js" defer></script><script src="/assets/js/2.7d16e0a0.js" defer></script><script src="/assets/js/9.822b995c.js" defer></script><script src="/assets/js/5.4d3df407.js" defer></script>
  </body>
</html>
